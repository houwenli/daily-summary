# 浏览器是如何渲染页面的

当地址栏输入地址后，浏览器就会启用一个网络线程去下载html，当收到html文档后就会产生一个渲染任务，并将其传递给渲染主线程的网络队列

在事件循环机制的作用下，渲染主线程会取出消息队列中的渲染任务，开启渲染进程

整个渲染流程像是一个流水线一样分为多个阶段，分别是：HTML解析，样式计算，布局，分层，绘制，分块，光栅化，画图

每个阶段都有明确的输入输出，上一个阶段的输出会成为下一个阶段的输入

## 渲染的第一步是解析HTML

解析过程中遇到css解析css，遇到js执行js。为了提高效率，浏览器在开始解析前，会启动一个与解析线程，率先下载html中的外部css文件和外部js文件

如果主线程解析到link为止，此时外部的css文件还没有下载解析好，主线程不会等待，继续解析后续的html，这是因为下载和解析css的工作是在预解析线程中惊醒的，这就是css不会阻塞HTML解析的根本原因

如果主线程解析到script位置，就会停止解析HTML，转而等待js文件下载好，并将全局代码解析执行完成后，才能继续解析HTML，这是因为js代码执行过程中可能会修改当前DOM树，所以DOM树的生成必须暂停。这就是js会阻塞HTML解析的根本原因

第一步完成之后，会得到DOM树和CSSOM树，浏览器的默认样式，外部样式，内部样式，行内样式都会包含在CSSOM树中

### HTML解析过程中遇到了css代码怎么办？

为了提高解析效率，浏览器会启动一个预解析器率先下载和解析css，这里仍然依靠网络线程下载

![alt text](浏览器渲染原理-解析遇到css.png)